<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Meteora MET Dashboard v2.0</title>
    <link rel="icon" type="image/svg+xml" href="./v2.svg">
    <link rel="shortcut icon" href="./v2.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>
    
    <script>
        // Áä∂ÊÄÅÂèòÈáè
        let metPairs = [];
        let poolWallets = {}; // lbPair -> [wallets]
        let poolEarnings = {}; // lbPair -> {wallet -> earnings}
        let poolInfo = {}; // lbPair -> {name, bin_step, liquidity, base_fee}
        let loading = false;
        let expandedPools = new Set();

        // ÂàÜÈ°µÁä∂ÊÄÅ
        let currentPage = 1;
        let itemsPerPage = 10;
        let searchTerm = '';
        let sortBy = 'walletCount'; // walletCount, earnings
        let sortOrder = 'desc';
        let walletPages = {}; // {lbPair: currentPage} - ÊØè‰∏™Ê±†Â≠êÁöÑÈí±ÂåÖÂàÜÈ°µ

        // ÈáçËØïÊú∫Âà∂
        const retryRequest = async (requestFn, maxRetries = 3, delay = 1000) => {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    return await requestFn();
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
                }
            }
        };

        // Ê†ºÂºèÂåñÂú∞ÂùÄ
        const formatAddress = (address) => {
            if (!address) return '';
            return `${address.slice(0, 6)}...${address.slice(-6)}`;
        };

        // Ê†ºÂºèÂåñÊï∞Â≠óÔºàÂ∏¶ÂçÉÂàÜ‰ΩçÔºâ
        const formatNumber = (num) => {
            if (!num) return '0.00';
            const n = parseFloat(num);
            return n.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };

        // Âä†ËΩΩÊâÄÊúâÊï∞ÊçÆÔºà‰ªéÊú¨Âú∞ JSON Êñá‰ª∂Ôºâ
        const fetchMetPairs = async () => {
            console.log('üì• fetchMetPairs Ë¢´Ë∞ÉÁî®');
            loading = true;
            render();
            try {
                console.log('üîÑ ÂºÄÂßãË∞ÉÁî® fetchWalletDataFromDune...');
                // Áõ¥Êé•‰ªéÊú¨Âú∞Êñá‰ª∂Âä†ËΩΩÊï∞ÊçÆÔºå‰∏çÂÜçËØ∑Ê±Ç Meteora API
                await fetchWalletDataFromDune();
                console.log('‚úÖ fetchWalletDataFromDune ÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå Error loading data:', error);
                console.error('‚ùå Error stack:', error.stack);
                alert('Failed to load data. Please ensure met_dune_data.json and met_earnings.json exist.');
            } finally {
                loading = false;
                render();
                console.log('‚úÖ fetchMetPairs ÂÆåÊàê');
            }
        };

        // ‰ªéÊú¨Âú∞Êñá‰ª∂Âä†ËΩΩÈí±ÂåÖÊï∞ÊçÆÂíåÈ¢ÑËÆ°ÁÆóÁöÑÊî∂ÁõäÊï∞ÊçÆ
        const fetchWalletDataFromDune = async () => {
            try {
                console.log('üìÇ ÂºÄÂßãÂä†ËΩΩÊú¨Âú∞Êï∞ÊçÆÊñá‰ª∂...');
                console.log('üîç ÂΩìÂâç URL:', window.location.href);

                // Âä†ËΩΩ MET Dune Êï∞ÊçÆ
                console.log('üì• Ê≠£Âú®ËØ∑Ê±Ç met_dune_data.json...');
                const duneResponse = await retryRequest(async () => {
                    const res = await fetch('./met_dune_data.json?t=' + Date.now());
                    console.log('üìä met_dune_data.json ÂìçÂ∫îÁä∂ÊÄÅ:', res.status);
                    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                    return res.json();
                });
                console.log('‚úÖ met_dune_data.json Âä†ËΩΩÊàêÂäü');

                // Âä†ËΩΩÈ¢ÑËÆ°ÁÆóÁöÑÊî∂ÁõäÊï∞ÊçÆ
                console.log('üì• Ê≠£Âú®ËØ∑Ê±Ç met_earnings.json...');
                const earningsResponse = await retryRequest(async () => {
                    const res = await fetch('./met_earnings.json?t=' + Date.now());
                    console.log('üìä met_earnings.json ÂìçÂ∫îÁä∂ÊÄÅ:', res.status);
                    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                    return res.json();
                });
                console.log('‚úÖ met_earnings.json Âä†ËΩΩÊàêÂäü');

                // Â§ÑÁêÜÈí±ÂåÖÊï∞ÊçÆ
                poolWallets = {};
                if (duneResponse.result && duneResponse.result.rows) {
                    duneResponse.result.rows.forEach(row => {
                        const lbPair = row.lbPair;
                        const wallet_array = row.wallet_array || [];
                        poolWallets[lbPair] = wallet_array;
                    });
                }

                // Âä†ËΩΩÈ¢ÑËÆ°ÁÆóÁöÑÊî∂ÁõäÊï∞ÊçÆ
                poolEarnings = earningsResponse.data || {};
                console.log(`‚úÖ Âä†ËΩΩ‰∫Ü ${Object.keys(poolEarnings).length} ‰∏™Ê±†Â≠êÁöÑÊî∂ÁõäÊï∞ÊçÆ`);
                console.log(`üìä Êï∞ÊçÆÊõ¥Êñ∞Êó∂Èó¥: ${earningsResponse.fetched_at}`);

                // Âä†ËΩΩÊ±†Â≠ê‰ø°ÊÅØ
                poolInfo = earningsResponse.pool_info || {};
                console.log(`‚úÖ Âä†ËΩΩ‰∫Ü ${Object.keys(poolInfo).length} ‰∏™Ê±†Â≠êÁöÑËØ¶ÁªÜ‰ø°ÊÅØ`);

                // ‰ªéÊ±†Â≠ê‰ø°ÊÅØÊûÑÂª∫ metPairs Êï∞ÁªÑ
                metPairs = Object.keys(poolInfo).map(address => ({
                    address: address,
                    name: poolInfo[address].name,
                    bin_step: poolInfo[address].bin_step,
                    liquidity: poolInfo[address].liquidity,
                    base_fee_percentage: poolInfo[address].base_fee_percentage,
                    fees_24h: 0  // ÊöÇÊó∂ËÆæ‰∏∫ 0ÔºåÂõ†‰∏∫Êàë‰ª¨Ê≤°ÊúâÂÆûÊó∂Êï∞ÊçÆ
                }));

                console.log(`‚úÖ Âä†ËΩΩ‰∫Ü ${metPairs.length} ‰∏™Ê±†Â≠ê`);

                render();
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Failed to load data. Please run: python3 fetch_met_data.py && python3 fetch_met_earnings.py');
            }
        };

        // Ëé∑ÂèñÈí±ÂåÖÁöÑÊî∂ÁõäÊï∞ÊçÆÔºà‰ªéÈ¢ÑËÆ°ÁÆóÁöÑÊï∞ÊçÆ‰∏≠Ôºâ
        const getWalletEarnings = (wallet, lbPair) => {
            return poolEarnings[lbPair]?.[wallet] || null;
        };

        // Ëé∑ÂèñÊ±†Â≠êÁöÑÊÄªÊî∂Áõä
        const calculatePoolTotalEarnings = (lbPair) => {
            const earnings = poolEarnings[lbPair] || {};
            let total = 0;
            Object.values(earnings).forEach(earning => {
                if (earning && earning.total_fee_usd_claimed) {
                    total += parseFloat(earning.total_fee_usd_claimed) || 0;
                }
            });
            return total;
        };

        // Ëé∑ÂèñÁ≠õÈÄâÂíåÊéíÂ∫èÂêéÁöÑÊ±†Â≠ê
        const getFilteredAndSortedPools = () => {
            let pools = metPairs.filter(p => poolWallets[p.address]);

            // ÊêúÁ¥¢ËøáÊª§
            if (searchTerm) {
                pools = pools.filter(p =>
                    p.address.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (p.name && p.name.toLowerCase().includes(searchTerm.toLowerCase()))
                );
            }

            // ÊåâÊÄªÊî∂ÁõäÂÄíÂ∫èÊéíÂ∫èÔºàÈªòËÆ§Ôºâ
            pools.sort((a, b) => {
                const aEarnings = calculatePoolTotalEarnings(a.address);
                const bEarnings = calculatePoolTotalEarnings(b.address);
                return bEarnings - aEarnings;
            });

            return pools;
        };

        // Ëé∑ÂèñÂΩìÂâçÈ°µÁöÑÊ±†Â≠ê
        const getCurrentPagePools = () => {
            const filtered = getFilteredAndSortedPools();
            const start = (currentPage - 1) * itemsPerPage;
            return filtered.slice(start, start + itemsPerPage);
        };

        // Ëé∑ÂèñÊÄªÈ°µÊï∞
        const getTotalPages = () => {
            const filtered = getFilteredAndSortedPools();
            return Math.ceil(filtered.length / itemsPerPage);
        };

        // Êõ¥Êñ∞ÊêúÁ¥¢
        const updateSearch = () => {
            searchTerm = document.getElementById('searchInput')?.value || '';
            currentPage = 1;
            render();
        };

        // Êõ¥ÊîπÈ°µÈù¢
        const changePage = (page) => {
            const totalPages = getTotalPages();
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                render();
            }
        };

        // ÂàáÊç¢Ê±†Â≠êÂ±ïÂºÄ
        const togglePool = (lbPair) => {
            if (expandedPools.has(lbPair)) {
                expandedPools.delete(lbPair);
            } else {
                expandedPools.add(lbPair);
            }
            render();
        };

        // Ëé∑ÂèñÊâÄÊúâÈí±ÂåÖÁöÑÊÄªÊî∂ÁõäÊéíË°åÊ¶ú
        const getTopWalletsByFees = (limit = 30) => {
            const walletFeesMap = new Map(); // wallet -> total fees

            // ÈÅçÂéÜÊâÄÊúâÊ±†Â≠êÁöÑÊâÄÊúâÈí±ÂåÖ
            Object.keys(poolEarnings).forEach(lbPair => {
                const earnings = poolEarnings[lbPair];
                Object.keys(earnings).forEach(wallet => {
                    const fees = parseFloat(earnings[wallet]?.total_fee_usd_claimed) || 0;
                    const currentFees = walletFeesMap.get(wallet) || 0;
                    walletFeesMap.set(wallet, currentFees + fees);
                });
            });

            // ËΩ¨Êç¢‰∏∫Êï∞ÁªÑÂπ∂ÊéíÂ∫è
            const walletArray = Array.from(walletFeesMap.entries())
                .map(([wallet, fees]) => ({ wallet, fees }))
                .sort((a, b) => b.fees - a.fees)
                .slice(0, limit);

            return walletArray;
        };

        // Ê∏≤ÊüìÊ±†Â≠êÈí±ÂåÖÂàóË°®ÔºàÂ∏¶ÂàÜÈ°µÔºâ
        const renderPoolWallets = (lbPair) => {
            const wallets = poolWallets[lbPair] || [];
            const earnings = poolEarnings[lbPair] || {};

            const walletsList = wallets
                .map(wallet => ({
                    wallet,
                    earning: earnings[wallet]
                }))
                .sort((a, b) => {
                    const aEarning = parseFloat(a.earning?.total_fee_usd_claimed) || 0;
                    const bEarning = parseFloat(b.earning?.total_fee_usd_claimed) || 0;
                    return bEarning - aEarning;
                });

            // ÂàÜÈ°µÈÄªËæë
            const walletsPerPage = 10;
            const currentWalletPage = walletPages[lbPair] || 1;
            const totalWalletPages = Math.ceil(walletsList.length / walletsPerPage);
            const startIdx = (currentWalletPage - 1) * walletsPerPage;
            const endIdx = startIdx + walletsPerPage;
            const paginatedWallets = walletsList.slice(startIdx, endIdx);

            return `
                <div class="border-t bg-gray-50 p-4">
                    <h4 class="font-semibold mb-3 flex items-center gap-2">
                        <i data-lucide="users" class="w-4 h-4"></i>
                        Wallets (${wallets.length})
                    </h4>

                    <div class="overflow-x-auto bg-white rounded-lg border">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b bg-gray-50">
                                    <th class="text-left py-2 px-4 font-semibold text-gray-700 text-sm">Wallet Address</th>
                                    <th class="text-center py-2 px-4 font-semibold text-gray-700 text-sm">Jupiter</th>
                                    <th class="text-center py-2 px-4 font-semibold text-gray-700 text-sm">LP Agent</th>
                                    <th class="text-right py-2 px-4 font-semibold text-gray-700 text-sm">Fees</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${paginatedWallets.map(({ wallet, earning }, index) => {
                                    const usdValue = earning?.total_fee_usd_claimed ? `$${formatNumber(earning.total_fee_usd_claimed)}` : '-';
                                    const lpAgentUrl = `https://app.lpagent.io/portfolio?address=${wallet}`;
                                    const jupiterUrl = `https://jup.ag/portfolio/${wallet}`;
                                    const rowColor = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';

                                    return `
                                        <tr class="${rowColor} hover:bg-blue-50 transition-colors border-b border-gray-100">
                                            <td class="py-2 px-4">
                                                <span class="font-mono text-sm text-gray-800">${wallet}</span>
                                            </td>
                                            <td class="py-2 px-4 text-center">
                                                <a href="${jupiterUrl}" target="_blank"
                                                   class="inline-block px-3 py-1 text-xs bg-purple-100 text-purple-700 hover:bg-purple-200 rounded transition-colors font-medium">
                                                    JUP
                                                </a>
                                            </td>
                                            <td class="py-2 px-4 text-center">
                                                <a href="${lpAgentUrl}" target="_blank"
                                                   class="inline-block px-3 py-1 text-xs bg-green-100 text-green-700 hover:bg-green-200 rounded transition-colors font-medium">
                                                    LP
                                                </a>
                                            </td>
                                            <td class="py-2 px-4 text-right">
                                                <span class="font-semibold text-green-600">${usdValue}</span>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>

                    ${totalWalletPages > 1 ? `
                        <div class="flex items-center justify-center gap-2 mt-4">
                            <button
                                onclick="changeWalletPage('${lbPair}', ${currentWalletPage - 1})"
                                ${currentWalletPage === 1 ? 'disabled' : ''}
                                class="px-3 py-1 bg-white border rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed text-sm"
                            >
                                Previous
                            </button>
                            <span class="text-sm text-gray-600">
                                Page ${currentWalletPage} of ${totalWalletPages}
                            </span>
                            <button
                                onclick="changeWalletPage('${lbPair}', ${currentWalletPage + 1})"
                                ${currentWalletPage === totalWalletPages ? 'disabled' : ''}
                                class="px-3 py-1 bg-white border rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed text-sm"
                            >
                                Next
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        };

        // ÂàáÊç¢Èí±ÂåÖÂàÜÈ°µ
        const changeWalletPage = (lbPair, newPage) => {
            walletPages[lbPair] = newPage;
            render();
        };

        // Ê∏≤Êüì MET Fees Leader ÊéíË°åÊ¶ú
        const renderFeesLeaderboard = () => {
            const topWallets = getTopWalletsByFees(30);

            if (topWallets.length === 0) {
                return '';
            }

            return `
                <div class="max-w-7xl mx-auto px-4 py-8">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="flex items-center gap-3 mb-6">
                            <i data-lucide="trophy" class="w-6 h-6 text-yellow-500"></i>
                            <h2 class="text-2xl font-bold text-gray-800">MET Fees Leader</h2>
                            <span class="text-sm text-gray-500">(Top 30 Wallets)</span>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b-2 border-gray-300">
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">#</th>
                                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Wallet Address</th>
                                        <th class="text-center py-3 px-4 font-semibold text-gray-700">Jupiter</th>
                                        <th class="text-center py-3 px-4 font-semibold text-gray-700">LP Agent</th>
                                        <th class="text-right py-3 px-4 font-semibold text-gray-700">Total Fees</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${topWallets.map((item, index) => {
                                        const lpAgentUrl = `https://app.lpagent.io/portfolio?address=${item.wallet}`;
                                        const jupiterUrl = `https://jup.ag/portfolio/${item.wallet}`;
                                        const rowColor = index === 0 ? 'bg-yellow-50' :
                                                        index === 1 ? 'bg-gray-50' :
                                                        index === 2 ? 'bg-orange-50' :
                                                        index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                                        const rankIcon = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';

                                        return `
                                            <tr class="${rowColor} hover:bg-blue-50 transition-colors border-b border-gray-200">
                                                <td class="py-3 px-4">
                                                    <div class="flex items-center gap-2">
                                                        <span class="font-bold text-gray-700">${index + 1}</span>
                                                        ${rankIcon ? `<span class="text-lg">${rankIcon}</span>` : ''}
                                                    </div>
                                                </td>
                                                <td class="py-3 px-4">
                                                    <span class="font-mono text-sm text-gray-800">${item.wallet}</span>
                                                </td>
                                                <td class="py-3 px-4 text-center">
                                                    <a href="${jupiterUrl}" target="_blank"
                                                       class="inline-block px-4 py-1.5 text-sm bg-purple-100 text-purple-700 hover:bg-purple-200 rounded transition-colors font-medium">
                                                        Jupiter
                                                    </a>
                                                </td>
                                                <td class="py-3 px-4 text-center">
                                                    <a href="${lpAgentUrl}" target="_blank"
                                                       class="inline-block px-4 py-1.5 text-sm bg-green-100 text-green-700 hover:bg-green-200 rounded transition-colors font-medium">
                                                        LP Agent
                                                    </a>
                                                </td>
                                                <td class="py-3 px-4 text-right">
                                                    <span class="font-bold text-green-600 text-lg">$${formatNumber(item.fees)}</span>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        };

        // Ê†ºÂºèÂåñÂ§ßÊï∞Â≠ó
        const formatLargeNumber = (num) => {
            if (!num) return '0';
            const n = parseFloat(num);
            if (n >= 1e9) return (n / 1e9).toFixed(2) + 'B';
            if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
            if (n >= 1e3) return (n / 1e3).toFixed(2) + 'K';
            return n.toFixed(2);
        };

        // Ê∏≤ÊüìÂçï‰∏™Ê±†Â≠ê
        const renderPool = (pool) => {
            const isExpanded = expandedPools.has(pool.address);
            const walletCount = (poolWallets[pool.address] || []).length;
            const totalEarnings = calculatePoolTotalEarnings(pool.address);

            // ‰ºòÂÖà‰ΩøÁî® poolInfo ‰∏≠ÁöÑÊï∞ÊçÆÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàô‰ΩøÁî® pool ‰∏≠ÁöÑÊï∞ÊçÆ
            const info = poolInfo[pool.address] || {};
            const poolName = info.name || pool.name || 'Unknown';
            const liquidity = parseFloat(info.liquidity || pool.liquidity) || 0;
            const binStep = info.bin_step || pool.bin_step || 0;
            const baseFee = info.base_fee_percentage || pool.base_fee_percentage || 0;
            const meteoraUrl = `https://app.meteora.ag/dlmm/${pool.address}?referrer=rochestor`;

            return `
                <div class="border rounded-lg overflow-hidden bg-white shadow-sm hover:shadow-md transition-shadow">
                    <div class="p-4 hover:bg-gray-50 cursor-pointer transition-colors" onclick="togglePool('${pool.address}')">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-3 flex-1">
                                <i data-lucide="${isExpanded ? 'chevron-down' : 'chevron-right'}" class="w-4 h-4 text-gray-500"></i>
                                <div>
                                    <a href="${meteoraUrl}" target="_blank" onclick="event.stopPropagation()" class="font-semibold text-lg text-blue-600 hover:text-blue-800 hover:underline">
                                        ${poolName}
                                    </a>
                                    <div class="font-mono text-xs text-gray-500 mt-1">
                                        ${formatAddress(pool.address)}
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-gray-600">${walletCount} wallets</div>
                                <div class="font-semibold text-green-600 text-lg">$${formatNumber(totalEarnings)}</div>
                            </div>
                        </div>
                        <div class="flex gap-2 mt-2">
                            <div class="px-3 py-2 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors flex-1">
                                <div class="text-xs text-gray-600">Bin Step</div>
                                <div class="font-semibold text-sm text-gray-800">${binStep}</div>
                            </div>
                            <div class="px-3 py-2 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors flex-1">
                                <div class="text-xs text-gray-600">Base Fee</div>
                                <div class="font-semibold text-sm text-gray-800">${baseFee}%</div>
                            </div>
                            <div class="px-3 py-2 bg-green-50 hover:bg-green-100 rounded-lg transition-colors flex-1">
                                <div class="text-xs text-gray-600">Liquidity</div>
                                <div class="font-semibold text-sm text-gray-800">$${formatLargeNumber(liquidity)}</div>
                            </div>
                        </div>
                    </div>
                    ${isExpanded ? renderPoolWallets(pool.address) : ''}
                </div>
            `;
        };

        // ‰∏ªÊ∏≤ÊüìÂáΩÊï∞
        const render = () => {
            const app = document.getElementById('app');
            if (!app) {
                console.error('‚ùå #app element not found!');
                return;
            }

            const filteredPools = getFilteredAndSortedPools();
            const currentPools = getCurrentPagePools();
            const totalPages = getTotalPages();

            // ËÆ°ÁÆóÊÄªÈí±ÂåÖÊï∞
            const totalWallets = Object.values(poolWallets).reduce((sum, wallets) => sum + wallets.length, 0);
            const totalEarnings = filteredPools.reduce((sum, p) => sum + calculatePoolTotalEarnings(p.address), 0);

            app.innerHTML = `
                <div class="min-h-screen bg-gray-50">
                    <!-- Header -->
                    <div class="bg-white border-b sticky top-0 z-10">
                        <div class="max-w-7xl mx-auto px-4 py-4">
                            <div class="mb-4">
                                <h1 class="text-2xl font-bold flex items-center gap-2">
                                    <i data-lucide="trending-up" class="w-6 h-6"></i>
                                    Meteora MET Dashboard
                                </h1>
                            </div>

                            <!-- Stats -->
                            <div class="grid grid-cols-4 gap-4 mb-4">
                                <div class="bg-blue-50 p-3 rounded">
                                    <div class="text-xs text-gray-600">MET Pools</div>
                                    <div class="text-xl font-bold">${filteredPools.length}</div>
                                </div>
                                <div class="bg-green-50 p-3 rounded">
                                    <div class="text-xs text-gray-600">Total Wallets</div>
                                    <div class="text-xl font-bold">${totalWallets}</div>
                                </div>
                                <div class="bg-purple-50 p-3 rounded">
                                    <div class="text-xs text-gray-600">Total Earnings</div>
                                    <div class="text-xl font-bold">$${formatNumber(totalEarnings)}</div>
                                </div>
                                <div class="bg-orange-50 p-3 rounded">
                                    <div class="text-xs text-gray-600">Avg Wallets/Pool</div>
                                    <div class="text-xl font-bold">${filteredPools.length > 0 ? formatNumber(totalWallets / filteredPools.length) : '0'}</div>
                                </div>
                            </div>

                            <!-- Controls -->
                            <div class="flex gap-2 items-center">
                                <input
                                    type="text"
                                    id="searchInput"
                                    placeholder="Search pool address or name..."
                                    onkeypress="if(event.key === 'Enter') updateSearch()"
                                    class="flex-1 px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"
                                >
                                <button
                                    onclick="updateSearch()"
                                    class="px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300"
                                >
                                    Search
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="max-w-7xl mx-auto px-4 py-6">
                        ${loading ? `
                            <div class="text-center py-12">
                                <i data-lucide="loader" class="w-8 h-8 animate-spin mx-auto mb-2"></i>
                                <p class="text-gray-600">Loading MET pools and wallet data...</p>
                            </div>
                        ` : filteredPools.length === 0 ? `
                            <div class="text-center py-12 bg-white rounded border">
                                <i data-lucide="inbox" class="w-8 h-8 text-gray-400 mx-auto mb-2"></i>
                                <p class="text-gray-600">No pools found</p>
                            </div>
                        ` : `
                            <!-- Pool List -->
                            <div class="space-y-3 mb-6">
                                ${currentPools.map(pool => renderPool(pool)).join('')}
                            </div>

                            <!-- Pagination -->
                            ${totalPages > 1 ? `
                                <div class="flex justify-between items-center">
                                    <div class="text-sm text-gray-600">
                                        Showing ${(currentPage - 1) * itemsPerPage + 1} - ${Math.min(currentPage * itemsPerPage, filteredPools.length)} of ${filteredPools.length}
                                    </div>
                                    <div class="flex gap-2">
                                        <button
                                            onclick="changePage(${currentPage - 1})"
                                            ${currentPage === 1 ? 'disabled' : ''}
                                            class="px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50"
                                        >
                                            Prev
                                        </button>
                                        <span class="px-3 py-2 bg-blue-500 text-white rounded">${currentPage} / ${totalPages}</span>
                                        <button
                                            onclick="changePage(${currentPage + 1})"
                                            ${currentPage === totalPages ? 'disabled' : ''}
                                            class="px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50"
                                        >
                                            Next
                                        </button>
                                    </div>
                                </div>
                            ` : ''}
                        `}
                    </div>

                    <!-- MET Fees Leader ÊéíË°åÊ¶ú -->
                    ${!loading && metPairs.length > 0 ? renderFeesLeaderboard() : ''}

                    <!-- ÂÖçË¥£Â£∞ÊòéÂíåÈ°µËÑö -->
                    <div class="max-w-7xl mx-auto px-4 py-8">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <!-- Support Âç°Áâá -->
                            <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                                <div class="flex flex-col items-center gap-4">
                                    <div class="flex items-center gap-2">
                                        <i data-lucide="coffee" class="w-6 h-6 text-amber-600"></i>
                                        <h3 class="text-lg font-semibold text-gray-800">Support</h3>
                                    </div>
                                    <p class="text-gray-600 text-sm">
                                        If this tool has been helpful for your DeFi journey, consider supporting its development.
                                    </p>
                                    <a
                                        href="https://tiplink.io/blinks/donate?dest=G4FEgdE3yduy8WexqLWda3SGYBTgnydP37GnCcZRJjPR"
                                        target="_blank"
                                        class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-medium rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl"
                                    >
                                        <i data-lucide="coffee" class="w-4 h-4"></i>
                                        Buy me a coffee ‚òï
                                    </a>
                                    <p class="text-xs text-gray-500">
                                        Powered by TipLink
                                    </p>
                                </div>
                            </div>

                            <!-- Disclaimer Âç°Áâá -->
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <div class="flex items-center gap-2 mb-4">
                                    <i data-lucide="alert-triangle" class="w-6 h-6 text-yellow-500"></i>
                                    <h3 class="text-lg font-semibold text-gray-800">Disclaimer</h3>
                                </div>
                                <div class="text-sm text-gray-600 space-y-2">
                                    <p>This tool is for informational purposes only and does not constitute financial advice.</p>
                                    <p>Cryptocurrency and DeFi investments carry significant risks, including potential loss of principal.</p>
                                    <p>Always conduct your own research and consult qualified financial advisors.</p>
                                </div>
                            </div>

                            <!-- Connect Âç°Áâá -->
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <div class="flex items-center gap-2 mb-4">
                                    <i data-lucide="users" class="w-6 h-6 text-blue-500"></i>
                                    <h3 class="text-lg font-semibold text-gray-800">Connect</h3>
                                </div>
                                <div class="space-y-3">
                                    <a href="https://x.com/rochestor_mu" target="_blank"
                                       class="flex items-center gap-2 text-blue-600 hover:text-blue-800 transition-colors">
                                        <i data-lucide="twitter" class="w-4 h-4"></i>
                                        <span class="text-sm">Follow on X (Twitter)</span>
                                    </a>
                                    <a href="https://github.com/gududefengzhong" target="_blank"
                                       class="flex items-center gap-2 text-gray-700 hover:text-gray-900 transition-colors">
                                        <i data-lucide="github" class="w-4 h-4"></i>
                                        <span class="text-sm">View on GitHub</span>
                                    </a>
                                    <a href="https://app.lpagent.io/?referral=GE6Csiu" target="_blank"
                                       class="flex items-center gap-2 text-green-600 hover:text-green-800 transition-colors">
                                        <i data-lucide="trending-up" class="w-4 h-4"></i>
                                        <span class="text-sm">Try LP Agent</span>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- È°µËÑöÁâàÊùÉ‰ø°ÊÅØ -->
                        <div class="text-center py-8 mt-8 border-t border-gray-200">
                            <div class="text-sm text-gray-500">
                                <div>Built with ‚ù§Ô∏è for the LP Army</div>
                                <div class="mt-1">¬© 2025 Meteora LB Pair Tracker</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ÂàùÂßãÂåñ Lucide ÂõæÊ†á
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                try {
                    lucide.createIcons();
                } catch (e) {
                    console.warn('Lucide icons initialization failed:', e);
                }
            }
        };

        // ÂàùÂßãÂåñ
        window.addEventListener('load', () => {
            console.log('üöÄ È°µÈù¢Âä†ËΩΩÂÆåÊàêÔºåÂºÄÂßãÂàùÂßãÂåñ...');
            loading = true;
            render(); // ÂÖàÊ∏≤ÊüìÂä†ËΩΩÁä∂ÊÄÅ
            fetchMetPairs();
        });
    </script>
</body>
</html>
